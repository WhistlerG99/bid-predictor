
aws configure sso # if first time

aws sso login --profile my-sso DevManage-622055002283


export AWS_REGION=us-east-1
export ACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text)
export REPO=bid-predictor-sklearn-gpu
export TAG=latest

aws ecr create-repository --repository-name $REPO >/dev/null 2>&1 || true
aws ecr get-login-password --region $AWS_REGION \
| docker login --username AWS --password-stdin \
  $ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com

# Build for amd64 and push (works from M-series Macs)
docker buildx create --use >/dev/null 2>&1 || true
docker buildx build --platform linux/amd64 \
  -f Dockerfile.gpu \
  -t $ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/$REPO:$TAG \
  --push .